---
title: "HW 06 Part 2: Wrangling II"
author: "Andrew Chronister"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

#Load tidyverse and knitr libraries
```{r}
library(tidyverse)
library(knitr)
install.packages("smatr")
library(smatr)
```
#defining path variable
```{r}
file_path <- "~/Documents/BI685Files/GitHubDocs/chronister_andrew/data/"
```
#Read in darters.txt
```{r}
start_pos <-  c(1,4,15,16,17,18,21,25,29,33,36,39,41)
stop_pos <- c(3,14,15,16,17,20,24,28,32,35,38,40,42)
names <- c("specimen id", "species", "riffle", "age", "sex", "length", "depth", "velocity", "temperature", "majsub", "minsub", "majtype", "mintype")
darters <- read_fwf(file.path(file_path, "darter.txt"), fwf_positions(start_pos, stop_pos, col_names = names), skip = 13)
darters
```
#remove tetrazonum and zonale
```{r}
darters2 <- darters %>%
  filter(!species %in% c("tetrazonum", "zonale"))
darters2
```
#Wrangle data
```{r}
  mutate(darters2,
       total_substrate = majsub + minsub
       )
```
#My calculations show that total_substrate = 1 for all observations.  

```{r}
mutate(darters2,
       total_substrate = majsub + minsub
       )

```
#Change riffle values
```{r}
  mutate(darters2,
         riffle = ifelse(riffle == 1,
                         "Riffle 1",
                         "Riffle 2"))
```
#Change length data from cm to mm
```{r}
  mutate(darters2,
         length = length * 10)
```
#Change sex values
```{r}
  mutate(darters2,
         sex = ifelse(sex == "f",
                      "Female",
                      "Male"))
```
#Summarize data
```{r}
darters_species_means <- darters2 %>%
  group_by(species, riffle) %>%
  summarize(length = mean(length, na.rm = TRUE),
            depth = mean(depth, na.rm = TRUE),
            velocity = mean(velocity, na.rm = TRUE)
            )
darters_species_means
```
#Plot 1
```{r}
ggplot(data = darters_species_means) +
  stat_summary(mapping = aes(x=species, y=length),
               fun.ymin = min,
               fun.ymax = max,
               fun.y = median
               ) +
  geom_point(data = darters_species_means, mapping = aes(x=species, y=length), shape = 15)
  
```
#Turn plot
```{r}
ggplot(data = darters_species_means) +
  stat_summary(mapping = aes(x=species, y=length),
               fun.ymin = min,
               fun.ymax = max,
               fun.y = median
               ) +
  geom_point(data = darters_species_means, mapping = aes(x=species, y=length), shape = 15)+
  coord_flip() 
  
```
#Add Facet wrap
```{r}
ggplot(data = darters_species_means) +
  stat_summary(mapping = aes(x=species, y=length),
               fun.ymin = min,
               fun.ymax = max,
               fun.y = median
               ) +
  geom_point(data = darters_species_means, mapping = aes(x=species, y=length), shape = 15)+
  coord_flip()+
  facet_wrap(~ riffle, nrow = 2)
```
#Change labels
```{r}
ggplot(data = darters_species_means) +
  stat_summary(mapping = aes(x=species, y=length),
               fun.ymin = min,
               fun.ymax = max,
               fun.y = median
               ) +
  geom_point(data = darters_species_means, mapping = aes(x=species, y=length), shape = 15)+
  coord_flip()+
  facet_wrap(~ riffle, nrow = 2)+
  labs(x = NULL, y = "Length (cm)")
```


#The mean size of of the spectabile and caeruleum species are significantly larger in riffle 1 than riffle 2. the blennioides species is the opposite, with modestly larger size in riffle 1 vs. riffle 2.

# Plot2
#initial plot
```{r}
ggplot(data = darters_species_means, mapping = aes(x=length, y=species))+
  geom_point(color = "grey60")
```
#add stat_summary
```{r}
ggplot(data=darters_species_means, mapping = aes(x=length, y=species))+
  stat_summary(mapping = aes(x=length, y=species),
               fun.y = median,
               geom = "point",
               size = 2.2
               )+
  geom_point(color="grey60")
```
#add second stat_summary
```{r}
ggplot(data = darters_species_means, mapping = aes(x=length, y=species))+
  stat_summary(mapping = aes(x=length, y=species),
               fun.y = median,
               geom = "point",
               size=2.2
               )+
  geom_point(color="grey60")+
  stat_summary(mapping = aes(x=length, y=species),
               fun.y = mean,
               geom = "point",
               size=3,
               color = "maroon"
               )
```
#flip, facet, label
```{r}
ggplot(data = darters_species_means, mapping = aes(x=length, y=species))+
  stat_summary(mapping = aes(x=length, y=species),
               fun.y = median,
               geom = "point",
               size=2.2
               )+
  geom_point(color="grey60")+
  stat_summary(mapping = aes(x=length, y=species),
               fun.y = mean,
               geom = "point",
               size=3,
               color = "maroon"
               )+
  coord_flip()+
  facet_wrap(~ riffle, nrow=2)+
  labs(y=NULL, x="Length (cm)")
```
####Stress and corticosterones in birds

```{r}
library(tidyverse)
library(smatr)
```

```{r}
file_path <- "~/Documents/BI685Files/GitHubDocs/chronister_andrew/data/"
names <- c("capture_date", "day", "site", "urban_score", "cortF", "cortB", "sex", "smi", "tarsus", "mass", "basal_cort", "stress_cort")
feathers <- read_csv(file.path(file_path, "feathers.csv"), locale = locale(decimal_mark = ","), skip = 1, col_names = names)
feathers
```
#the data is tidy. Each column is a variable, each row is an observation, and each cell is a value.

#convert decimal mark, change column names done above

##Wrangle data
#calculate mean tarsus
```{r}
mean_tarsus <- mean(feathers[["tarsus"]])
mean_tarsus
```
#use mutate to transform
```{r}
feathers2 <- mutate(feathers,
       log_mass = log(mass),
       log_tarsus = log(tarsus)
       )
feathers2

```
#Run function
```{r}
major_axis <- sma(log_mass ~ log_tarsus, data = feathers2)
major_axis
```
#Note, I have no idea what those numbers mean.  Wow... just wow.  :D

#Apply the summary function
```{r}
summary(major_axis)
```
#Apply the coef function
```{r}
coef(major_axis)
b <- 1.864889
b
```
#put it all together to figure out SMI
```{r}
mutate(feathers2,
       new_smi = mass * (mean_tarsus / tarsus)^b)



  


```
#smi and new_smi are very similar. now on to summarize...


