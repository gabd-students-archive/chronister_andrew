---
title: "HW 09: Strings"
author: "Andrew Chronister"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---
***
###Install and load the libraries
```{r}
install.packages("ggthemes")
install.packages("RColorBrewer")
install.packages("viridis")
library(tidyverse)
library(htmlwidgets)

```
***
###Define the file.path
```{r}
file_path <- "~/Documents/BI685Files/GitHubDocs/chronister_andrew/data"
```


***
###Part 1:DNA Strings
***
####Read in the data
```{r}
(gliadin_raw <- read_lines(file.path(file_path, "beta_gliadin.txt"), skip = 1))
```
***
###"Tidy" and "Wrangle" the data
#Getting rid of the spaces, digits and tabs.
```{r}
gliadin_interm <- gliadin_raw%>%
  str_replace_all(" ", "")%>%
  str_replace_all("\\d", "")%>%
  str_replace_all("\\t", "")
gliadin_interm
```
#Collapse the strings into just one string.
```{r}
gliadin_seq <- gliadin_interm%>%
  str_c(collapse = "")
gliadin_seq
```
#Convert case to upper.
```{r}
gliadin_seq <- gliadin_seq%>%
  str_to_upper()
gliadin_seq
str_length(gliadin_seq)
```
#The DNA sequence is 3310 characters long. I guess I got it right.  

***
###Sequence analysis: find the promoter region
#Use string count to find non ACGT letters.
```{r}
str_count(gliadin_seq, "[^ACGT]")
```
#I came up with 0 letters that are not ACGT.

#Count possible Start codons. Count possible Stop codons.
```{r}
str_count(gliadin_seq, "ATG")
str_count(gliadin_seq, "TGA|TTA")
```
#Assign CAAT and TATA box variables
```{r}
caat_box <- c("CCAAT")
tata_box <- c("CTATAA")
str_count(gliadin_seq, caat_box)
str_count(gliadin_seq, tata_box)
```
#Create CAAT sequence searrch string.
```{r}
caat_seq <- "CCAAT.{100,150}ATG"
str_count(gliadin_seq, caat_seq)
```
#The CAAT sequence occurs twice in those conditions. I got hung up on this for a few minutes because a space worked its way in between the "(" and the "ATC".  I kept coming up with 0 in the results.  
#Now for the TATA box extraction
```{r}
caat_seqs_all <- str_extract_all(gliadin_seq, caat_seq, simplify = TRUE)
caat_seqs_all
str_count(caat_seqs_all)

```
#Use str_which to find which seq has tatabox
```{r}
tata_seq <- "CTATAA.{50,100}ATG"
caat_tata <- str_which(caat_seqs_all, tata_seq)
promotor <- str_subset(caat_seqs_all, tata_seq)
promotor
str_length(promotor)
```

***
###Part 2: Ants!
***
###Load the Libraries and define the file path. (packages are already installed, but if they weren't, I'd be doing this.)
```{r}
install.packages("ggthemes")
install.packages("RColorBrewer")
install.packages("viridis")
library(tidyverse)
library(htmlwidgets)
file_path <- "~/Documents/BI685Files/GitHubDocs/chronister_andrew/data"
```
***
###Read in the data.
```{r}
ants_raw <- read_csv(file.path(file_path, "ants.csv"))
ants_raw
```

***
###Tidy the data and wrangle it
```{r}
ants_data <- ants_raw %>%
  select(-c(season, seas.code, trt, plot, sample))%>%
  gather(key = species, value = abundance, matches("\\w\\.\\w", ignore.case = FALSE))
ants_data
```
#Removing the seas.code row makes the gather much easier.  

#The hardest part maybe...
```{r}
ant_abundance <- ants_data%>%
  mutate(
    species = str_replace(
      species,
      pattern = "(^[A-Z]*\\w{3})\\w+\\.(\\w{4})\\w+",
    replacement = "\\1\\2"),
    year = factor(year, levels = c("2010", "2011"), labels = c("2010", "2011"), ordered = TRUE))%>%
  group_by(year, species)%>%
  summarize(total = sum(abundance, na.rm=TRUE))
ant_abundance
```
#Sheesh.  My brain hurts.  

***
###Plot the data
```{r}
ant_abundance%>%
  ggplot(aes(x = reorder(species, total), y = total, group = species))+
  geom_line(color = "gray")+
  geom_point(aes(shape = year), size = 2)+
  coord_flip()+
  labs(x = NULL, y = "Total Abundance", shape = "Year")+
  theme_minimal()
```
#So in the slope graph, you are simply adding the points and text to the ends of a line graph. Interesting.










